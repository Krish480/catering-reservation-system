<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Orders - MealMatrix</title>
  <link rel="icon" href="/images/logo.png">
  <link rel="stylesheet" href="./css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css"
    integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 font-sans">

  <!-- Header -->
  <%- include("../partials/header") %>

  <!-- Orders Section -->
  <section class="py-10">
    <div class="container mx-auto px-4">
      <br>
      <br>
      <br>
      <h2 class="text-3xl font-bold text-orange-600 mb-6">My Orders</h2>

      <!-- Orders List -->
      <div id="ordersList" class="space-y-4">
        <!-- Dynamic orders -->
      </div>
    </div>
  </section>

  <!-- Order Tracking Modal -->
  <div id="trackingModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white rounded-lg shadow-lg w-11/12 md:w-2/3 lg:w-1/2 p-6 relative">
      <button onclick="closeModal()" class="absolute top-3 right-3 text-gray-500 hover:text-black">
        <i class="fa fa-times text-lg"></i>
      </button>
      <h3 id="modalTitle" class="text-xl font-semibold mb-4">Order Tracking</h3>
      <div id="timeline" class="relative border-l-4 border-orange-600 pl-6 space-y-6"></div>
    </div>
  </div>

  <script>
    // Dummy Data (future me db/json se aayega)
    const orders = [
      {
        id: "ORD123",
        product: { name: "Paneer Butter Masala", imageUrl: "/images/paneer_masala.png" },
        status: "Delivered",
        date: "2025-09-15",
        timeline: [
          { title: "Order Confirmed", date: "2025-09-12", completed: true },
          { title: "Shipped", date: "2025-09-13", completed: true },
          { title: "Out For Delivery", date: "2025-09-14", completed: true },
          { title: "Delivered", date: "2025-09-15", completed: true }
        ]
      },
      {
        id: "ORD124",
        product: { name: "Veg Biryani", imageUrl: "/images/Veg_biryani.png" },
        status: "Shipped",
        date: "2025-09-14",
        timeline: [
          { title: "Order Confirmed", date: "2025-09-13", completed: true },
          { title: "Shipped", date: "2025-09-14", completed: true },
          { title: "Out For Delivery", date: "", completed: false },
          { title: "Delivered", date: "", completed: false }
        ]
      }
    ];

    const ordersList = document.getElementById("ordersList");
    const trackingModal = document.getElementById("trackingModal");
    const modalTitle = document.getElementById("modalTitle");
    const timelineDiv = document.getElementById("timeline");

    // Render Orders List
    orders.forEach(order => {
      const div = document.createElement("div");
      div.className = "bg-white shadow-md rounded-lg p-4 flex items-center justify-between hover:shadow-lg transition cursor-pointer";
      div.innerHTML = `
        <div class="flex items-center gap-4">
          <img src="${order.product.imageUrl}" class="w-auto h-16 object-cover rounded-md">
          <div>
            <p class="font-semibold text-gray-800">${order.product.name}</p>
            <p class="text-sm text-gray-500">${order.status} on ${order.date}</p>
          </div>
        </div>
        <i class="fa fa-angle-right text-orange-600 text-xl"></i>
      `;
      div.addEventListener("click", () => openModal(order));
      ordersList.appendChild(div);
    });

    // Open Modal with Tracking Timeline
    function openModal(order) {
      modalTitle.textContent = `Order Tracking - ${order.id}`;
      timelineDiv.innerHTML = "";

      order.timeline.forEach(step => {
        const stepDiv = document.createElement("div");
        stepDiv.innerHTML = `
          <div class="${step.completed ? 'text-green-600' : 'text-gray-400'} font-semibold">
            ${step.title}
          </div>
          <p class="text-sm text-gray-500">${step.date || ""}</p>
        `;
        timelineDiv.appendChild(stepDiv);
      });

      trackingModal.classList.remove("hidden");
    }

    // Close Modal
    function closeModal() {
      trackingModal.classList.add("hidden");
    }
  </script>
</body>
</html>
