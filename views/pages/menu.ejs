<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MealMatrix - Menu</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 font-sans">
  <%- include("../partials/header") %>
  <br>
  <br>
  <!-- Menu Section -->
  <section class="container mx-auto py-16 px-6">
    <h2 class="text-3xl font-bold text-center text-gray-800 mb-10">Our Menu</h2>
    <div id="menu-container" class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
      <!-- Items dynamically injected from JSON -->
    </div>
  </section>

  <%- include("../partials/footer") %>

  <script>
  let menuItemsCache = [];
  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  // Utility
  function saveCart(){ 
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCount();
  }
  function updateCartCount(){
    const count = cart.reduce((s,i)=> s + (i.quantity||1), 0);
    const el = document.getElementById('cart-count');
    if(el) el.textContent = count;
  }
  function showToast(msg){
    const t = document.createElement('div');
    t.textContent = msg;
    t.className = 'fixed bottom-6 right-6 bg-gray-800 text-white px-4 py-2 rounded shadow';
    document.body.appendChild(t);
    setTimeout(()=> t.remove(), 1700);
  }

  async function loadMenu() {
    const menuContainer = document.getElementById("menu-container");
    menuContainer.innerHTML = "<p class='text-center col-span-3'>Loading menu...</p>";

    try {
      const res = await fetch("/data/menu.json");
      const items = await res.json();
      menuItemsCache = items; 
      menuContainer.innerHTML = "";

      items.forEach(item => {
        const card = document.createElement('div');
        card.className = 'bg-white p-6 shadow-md rounded-xl hover:shadow-xl transition';

        const img = document.createElement('img');
        img.src = item.imageUrl;
        img.alt = item.name;
        img.className = 'w-full object-cover rounded-md drop-shadow-[0_10px_15px_rgba(0,0,0,0.35)] mx-auto';

        const title = document.createElement('h3');
        title.className = 'mt-4 text-xl font-semibold text-gray-800 text-center';
        title.textContent = item.name;

        const price = document.createElement('p');
        price.className = 'text-gray-600 text-center';
        price.textContent = 'â‚¹' + item.price;

        const btnWrap = document.createElement('div');
        btnWrap.className = 'text-center';

        const btn = document.createElement('button');
        btn.className = 'mt-4 bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700';
        btn.textContent = 'Add to Cart';
        btn.dataset.id = item.id;
        btn.addEventListener('click', () => addToCartById(item.id));

        btnWrap.appendChild(btn);
        card.appendChild(img);
        card.appendChild(title);
        card.appendChild(price);
        card.appendChild(btnWrap);

        menuContainer.appendChild(card);
      });

    } catch (err) {
      console.error(err);
      menuContainer.innerHTML = "<p class='text-red-500'>Failed to load menu data.</p>";
    }
  }

  function addToCartById(id){
    const item = menuItemsCache.find(x => String(x.id) === String(id));
    if(!item){ alert('Item not found'); return; }

    const existing = cart.find(x => String(x.id) === String(id));
    if(existing) existing.quantity = (existing.quantity||1) + 1;
    else cart.push({ id: item.id, name: item.name, price: item.price, imageUrl: item.imageUrl, quantity: 1 });

    saveCart();
    showToast(item.name + ' added to cart ðŸ›’');
  }

  // on page load
  window.addEventListener('DOMContentLoaded', () => {
    loadMenu();
    updateCartCount();
  });
</script>

</body>
</html>
